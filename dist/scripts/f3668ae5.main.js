function resetCounts(){return{a:0,b:0,u:0,l:0,r:0,d:0,s:0,e:0,n:0,m:0}}function animate(){ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.restore();var a=1,b=counts.a*a,c=counts.b*a,d=counts.u*a,e=counts.d*a,f=counts.l*a,g=counts.r*a,h=counts.s*a,i=counts.e*a,j=counts.m*a,k=counts.n*a,l=politicsCounts.m*(100/politicsQueueLength),m=politicsCounts.n*(100/politicsQueueLength),n=d+e+f+g;ctx.globalAlpha=.25,ctx.lineWidth=.5,ctx.strokeStyle="#AAA";var o=100.5;ctx.moveTo(o,.5),ctx.lineTo(o,200.5),ctx.moveTo(.5,o),ctx.lineTo(200.5,o),ctx.stroke(),ctx.strokeStyle="#000",ctx.lineWidth=.5,ctx.fillStyle="#EEE",ctx.moveTo(o,o-d),ctx.lineTo(o+g,o),ctx.lineTo(o,o+e),ctx.lineTo(o-f,100),ctx.lineTo(o,o-d),ctx.stroke(),ctx.fill(),ctx.globalAlpha=1,ctx.fillStyle="#000",ctx.beginPath();var p=250.5,q=60.5;ctx.fillRect(p,q,b,5),ctx.fillRect(p,q+15,c,5),ctx.fillRect(p,q+30,h,5),ctx.fillRect(p,q+45,i,5),ctx.fillRect(p,q+60,j,5),ctx.fillRect(p,q+75,k,5),ctx.fillRect(p,q+90,n,5),ctx.font="10px Arial",ctx.fillText("A",p-35,q+5),ctx.fillText("B",p-35,q+5+15),ctx.fillText("STAR",p-35,q+5+30),ctx.fillText("SELE",p-35,q+5+45),ctx.fillText("DEMO",p-35,q+5+60),ctx.fillText("ANAR",p-35,q+5+75),ctx.fillText("DPAD",p-35,q+5+90),ctx.fillText(b+"%",p+117,q+5),ctx.fillText(c+"%",p+117,q+5+15),ctx.fillText(h+"%",p+117,q+5+30),ctx.fillText(i+"%",p+117,q+5+45),ctx.fillText(j+"%",p+117,q+5+60),ctx.fillText(k+"%",p+117,q+5+75),ctx.fillText(n+"%",p+117,q+5+90),ctx.fill();var r=canvas.width/2,s=238.5;ctx.beginPath(),ctx.fillStyle="#E82C0C",ctx.fillRect(r,s-30,l-m,5),ctx.fillStyle="#000",ctx.fillRect(r+30,s-30-2,1,8),ctx.fillRect(r,s-30-2,1,8),ctx.fillStyle="#aaaaaa",ctx.fillRect(r+50,s-30-2,1,8),ctx.fillRect(r-50,s-30-2,1,8),ctx.fillStyle="#000",ctx.font="10px Arial",ctx.fillText("DEMOCRACY",r+54,s+5-30),ctx.fillText("ANARCHY",r-104,s+5-30),ctx.fill();var t=Math.atan2((g-f)/2,(e-d)/2);ctx.strokeStyle="#000",ctx.lineWidth=1,ctx.beginPath(),ctx.fillStyle="#b2b2b2",ctx.fillText("AVG direction of RED",50.5,140.5),ctx.fill(),ctx.fillStyle="#000",ctx.beginPath(),ctx.fillStyle="#555",ctx.fillText("last "+queue.length+" keys",p+35,q-15),ctx.fill();var u=Math.sqrt((g-f)*(g-f)+(d-e)*(d-e));4>u&&(u=4);var v=100.5,w=100.5;ctx.strokeStyle="#E82C0C",ctx.moveTo(v,w),ctx.lineTo(v+Math.sin(t)*u,w+Math.cos(t)*u),ctx.stroke(),ctx.beginPath(),ctx.strokeStyle="#cccccc",ctx.moveTo(v,w),ctx.lineTo(v+100*Math.sin(t),w+100*Math.cos(t)),ctx.stroke(),ctx.beginPath();var x=.1,y=3;ctx.strokeStyle="#000",ctx.lineTo(v+Math.sin(t-x)*(u-y),w+Math.cos(t-x)*(u-y)),ctx.lineTo(v+Math.sin(t+x)*(u-y),w+Math.cos(t+x)*(u-y)),ctx.lineTo(v+Math.sin(t)*u,w+Math.cos(t)*u),ctx.fill(),ctx.stroke(),ctx.fillStyle="#000",ctx.font="10px Arial",ctx.fillText(commandsPerSecond+" keys/s",290,175),window.requestAnimationFrame(animate)}if("localhost"===location.host.split(":")[0])var socket=io.connect("http://localhost:8080");else var socket=io.connect(location.host);!function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)};window.requestAnimationFrame=a}();var counts=resetCounts(),politicsCounts={n:0,m:0},canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),queue=[],politicsQueue=[],perSecondQueue=[],queueLength=100,politicsQueueLength=1e3;socket.on("k",function(a){var b=a.k;counts[b]++,queue.length>=queueLength&&counts[queue.shift()]--,queue.push(b),("m"===b||"n"===b)&&(politicsCounts[b]++,politicsQueue.length>=politicsQueueLength&&politicsCounts[politicsQueue.shift()]--,politicsQueue.push(b)),perSecondQueue.push(b)});var commandsPerSecond=0;setInterval(function(){commandsPerSecond=perSecondQueue.length,perSecondQueue=[]},1e3),animate();